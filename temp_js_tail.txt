      if (entry.isIntersecting) {
        navLinks.forEach((l) =>
          l.classList.toggle("active", byId(l.getAttribute("href")) === id)
        );
      }
    });
  },
  { rootMargin: "-40% 0px -55% 0px", threshold: 0 }
);

sections.forEach((s) => obs.observe(s));

// Reveal animations on scroll
const revealEls = Array.from(document.querySelectorAll(".reveal"));
const revealObs = new IntersectionObserver(
  (entries) => {
    entries.forEach((e) => {
      if (e.isIntersecting) {
        e.target.classList.add("visible");
        revealObs.unobserve(e.target);
      }
    });
  },
  { threshold: 0.15 }
);
revealEls.forEach((el) => revealObs.observe(el));

// Contact form simple validation
const form = document.getElementById("contactForm");
const yearEl = document.getElementById("year");
yearEl.textContent = new Date().getFullYear();

form?.addEventListener("submit", (e) => {
  e.preventDefault();
  const name = form.name.value.trim();
  const email = form.email.value.trim();
  const message = form.message.value.trim();
  const errName = document.getElementById("errName");
  const errEmail = document.getElementById("errEmail");
  const errMessage = document.getElementById("errMessage");
  errName.textContent = errEmail.textContent = errMessage.textContent = "";

  let ok = true;
  if (name.length < 2) {
    errName.textContent = "Укажите имя (2+ символа).";
    ok = false;
  }
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
    errEmail.textContent = "Некорректный email.";
    ok = false;
  }
  if (message.length < 10) {
    errMessage.textContent = "Сообщение слишком короткое.";
    ok = false;
  }
  if (!ok) return;

  // Demo success (no backend here)
  form.reset();
  const btn = form.querySelector("button");
  const text = btn.textContent;
  btn.disabled = true;
  btn.textContent = "Отправлено ✓";
  setTimeout(() => {
    btn.disabled = false;
    btn.textContent = text;
  }, 2000);
});

// Smooth FAQ accordion animations
(function initFaqAccordion() {
  const acc = Array.from(document.querySelectorAll("#faq .faq-new details"));
  if (!acc.length) return;

  // Используем чисто CSS-анимации (max-height/opacity/transform)
  acc.forEach((el) => {
    const summary = el.querySelector("summary");
    if (!summary) return;

    function onToggleClick(e) {
      e.preventDefault();
      if (el.hasAttribute("open")) el.removeAttribute("open");
      else el.setAttribute("open", "");
    }

    summary.addEventListener("click", onToggleClick);
    summary.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        onToggleClick(e);
      }
